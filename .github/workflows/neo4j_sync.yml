name: Neo4j Data Sync

# 언제 실행할까요? -> main 브랜치에 코드가 올라올 때(push)
on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # 수동 실행 버튼도 추가

jobs:
  sync-job:
    runs-on: ubuntu-latest

    steps:
    # 1. 깃허브에 올라온 코드를 내려받음
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. 파이썬 설치 (3.9 버전)
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 필요한 라이브러리 설치
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas neo4j python-dotenv

    # 4. 로더 실행 (비밀번호는 Secrets에서 가져옴)
    - name: Run Loader Script
      env:
        NEO4J_URI: ${{ secrets.NEO4J_URI }}
        NEO4J_USERNAME: ${{ secrets.NEO4J_USERNAME }}
        NEO4J_PASSWORD: ${{ secrets.NEO4J_PASSWORD }}
      run: python loader.py